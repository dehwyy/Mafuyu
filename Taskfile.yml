version: '3'

dotenv: [.env]

tasks:
  db:migrate:
    cmds:
      - go run libs/db/src/main.go migrate
      - cd libs/db && sea-orm-cli generate entity -u $DATABASE_URL -o src/rust/models

  db:test-drop:

    cmds:
      - go run libs/db/src/main.go test-drop

  db:test-migrate:
    cmds:
      - go run libs/db/src/main.go test-migrate

  grpc:
    dir: libs/grpc
    cmds:
      - cargo run
      - protoc -I=protos --ts_out=dist --ts_opt=generate_dependencies,eslint_disable,ts_nocheck,output_javascript protos/*.proto
      - protoc -I protos --ts_out=dist --ts_opt=generate_dependencies,eslint_disable,ts_nocheck,output_javascript protos/api.proto
      - pnpm ts